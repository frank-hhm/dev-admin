import{a4 as Y,a5 as Z,a3 as ee,a6 as m,bg as le,a8 as ve,ad as be,bh as ge,bi as xe,ac as Ce,ah as ae,ab as Q,bj as Fe,ai as Ve,aU as ue,aV as he,be as X,al as N,ar as e,as as l,an as R,bk as ye,bl as Ee,au as te,av as H,aD as g,aK as k,am as y,aE as b,ao as De,aW as ne,bm as Be,aq as B,aX as ke,bn as Ae,bo as Me,aF as Re,bp as Ue,bq as we,br as Ie,ay as Se,aa as Te,bs as $e,bt as Le,b5 as Ne,b3 as ze,ap as V,bu as Oe,bv as je,aN as qe,bw as Ge,bx as Ke,b1 as Pe}from"./index.200d5b7d.js";const We={name:"menusCreateComponent"},Xe=Y({...We,emits:["success"],setup(oe,{expose:U,emit:z}){const{isMobile:E}=Z(ee()),{proxy:_,proxy:{$utils:D}}=H(),d=m("60px"),w=m(le().getEnumItem("StatusEnum")),f=m("create"),x=m(0),v=m(!1),O=m(),a=m({module:1,type:1,menu_name:"",pid:null,menu_path:"",menu_node:"",params:"",icon:"",sort:0,status:1,api_rule:""}),j=()=>{G(),x.value&&(i.value=!0,Ae({id:x.value}).then(t=>{a.value.type=Number(t.data.type),a.value.module=Number(t.data.module),a.value.menu_name=t.data.menu_name,t.data.pid>0&&(a.value.pid=Number(t.data.pid)),a.value.menu_path=t.data.menu_path,a.value.menu_node=t.data.menu_node,a.value.params=t.data.params,a.value.icon=t.data.icon,a.value.sort=t.data.sort,a.value.status=t.data.status.value,a.value.api_rule=t.data.api_rule,i.value=!1}).catch(t=>{D.errorMsg(t)}))},q=ve({menu_name:[{required:!0,message:"\u83DC\u5355\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01"}]}),i=m(!1),n=z,c=m(!1),C=()=>{var t;(t=_==null?void 0:_.$refs.createRef)==null||t.validate((u,h)=>{if(!u){if(c.value)return;c.value=!0;let r=null;f.value=="create"?r=ye(a.value):r=Ee(Object.assign({id:x.value},a.value)),r.then(p=>{D.successMsg(p.message),F(),n("success"),c.value=!1}).catch(p=>{D.errorMsg(p),c.value=!1})}})},I=m([]),G=()=>{let t={};x.value&&(t.pid=x.value),Me(t).then(u=>{I.value=u.data.menuList}).catch(u=>{D.errorMsg(u)})},K=t=>{},S=m(),T=m(),P=t=>{a.value.api_rule=t.rule},A=t=>{a.value.icon=t},o=(t=0,u)=>{t!=0?(f.value="update",x.value=t):f.value="create",u!="all"&&(a.value.module=u),te(()=>{j()}),v.value=!0},F=()=>{var t;return(t=_==null?void 0:_.$refs.createRef)==null||t.resetFields(),x.value=0,v.value=!1,!0};return U({open:o}),(t,u)=>{const h=be,r=Re,p=Ue,$=ge,W=we,se=xe,de=Ce,L=ae,ie=Q("select-icon-modal"),M=Ie,ce=Fe,me=Ve,re=ue,pe=Q("select-rule-modal"),_e=he,fe=X("loading"),J=X("btn");return g(),N("div",null,[e(_e,{title:f.value=="create"?"\u6DFB\u52A0\u83DC\u5355":"\u7F16\u8F91\u83DC\u5355",onBeforeOk:C,onBeforeCancel:F,width:R(E)?"calc(100% - 20px)":"900px",top:R(ke)().ModalTop,class:"modal",visible:v.value,"onUpdate:visible":u[13]||(u[13]=s=>v.value=s),"align-center":!1,"title-align":"start","render-to-body":""},{footer:l(()=>[e(re,null,{default:l(()=>[k((g(),y(L,{onClick:F},{default:l(()=>[b("\u53D6\u6D88")]),_:1})),[[J]]),k((g(),y(L,{type:"primary",disabled:i.value||c.value,loading:i.value,onClick:C},{default:l(()=>[b("\u786E\u5B9A")]),_:1},8,["disabled","loading"])),[[J]])]),_:1})]),default:l(()=>[k((g(),y(me,{model:a.value,layout:R(E)?"vertical":"horizontal",ref_key:"createRef",ref:O,rules:q},{default:l(()=>[e(M,{gutter:20},{default:l(()=>[e(p,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u83DC\u5355\u540D\u79F0",field:"menu_name"},{default:l(()=>[e(h,{modelValue:a.value.menu_name,"onUpdate:modelValue":u[0]||(u[0]=s=>a.value.menu_name=s),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(p,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6A21\u5757",field:"module"},{default:l(()=>[e(W,{modelValue:a.value.module,"onUpdate:modelValue":u[1]||(u[1]=s=>a.value.module=s)},{default:l(()=>[e($,{value:1},{default:l(()=>[b("\u7CFB\u7EDF")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(p,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u7C7B\u578B",field:"type"},{default:l(()=>[e(W,{modelValue:a.value.type,"onUpdate:modelValue":u[2]||(u[2]=s=>a.value.type=s)},{default:l(()=>[e($,{value:1},{default:l(()=>[b("\u83DC\u5355")]),_:1}),e($,{value:2},{default:l(()=>[b("\u4E8B\u4EF6")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(p,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u7236\u7EA7\u5206\u7C7B",field:"pid"},{default:l(()=>[e(se,{modelValue:a.value.pid,"onUpdate:modelValue":u[3]||(u[3]=s=>a.value.pid=s),options:I.value,onChange:K,"allow-search":"","allow-clear":"",class:"form-select-fil","check-strictly":"",placeholder:"\u8BF7\u9009\u62E9\u7236\u7EA7\u5206\u7C7B"},null,8,["modelValue","options"])]),_:1},8,["label-col-flex"])]),_:1}),e(p,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u56FE\u6807",field:"icon",class:"default-append"},{default:l(()=>[e(h,{modelValue:a.value.icon,"onUpdate:modelValue":u[5]||(u[5]=s=>a.value.icon=s),placeholder:"\u9009\u62E9\u56FE\u6807"},{prefix:l(()=>[e(de)]),append:l(()=>[e(L,{onClick:u[4]||(u[4]=()=>{T.value.open()})},{default:l(()=>[b(" \u56FE\u6807 ")]),_:1}),e(ie,{ref_key:"selectModalIconRef",ref:T,onChange:A},null,512)]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[a.value.type!=3?(g(),y(p,{key:0,md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u8DEF\u7531\u5730\u5740",field:"menu_path"},{default:l(()=>[e(h,{modelValue:a.value.menu_path,"onUpdate:modelValue":u[6]||(u[6]=s=>a.value.menu_path=s),placeholder:"\u8BF7\u8F93\u5165\u8DEF\u7531\u5730\u5740"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})):De("",!0),e(p,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u63A5\u53E3",field:"api_rule",class:"default-append"},{default:l(()=>[e(h,{disabled:"",modelValue:a.value.api_rule,"onUpdate:modelValue":u[8]||(u[8]=s=>a.value.api_rule=s),placeholder:"\u8BF7\u9009\u62E9\u63A5\u53E3"},{append:l(()=>[e(L,{onClick:u[7]||(u[7]=()=>{S.value.open()})},{default:l(()=>[b(" \u63A5\u53E3 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(p,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6743\u9650\u6807\u8BC6",field:"menu_node"},{default:l(()=>[e(h,{modelValue:a.value.menu_node,"onUpdate:modelValue":u[9]||(u[9]=s=>a.value.menu_node=s),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u6807\u8BC6"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(p,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u53C2\u6570",field:"params"},{default:l(()=>[e(h,{modelValue:a.value.params,"onUpdate:modelValue":u[10]||(u[10]=s=>a.value.params=s)},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(p,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6392\u5E8F\uFF1A",field:"sort"},{default:l(()=>[e(ce,{modelValue:a.value.sort,"onUpdate:modelValue":u[11]||(u[11]=s=>a.value.sort=s),min:0,max:1e4},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(p,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u72B6\u6001",field:"status"},{default:l(()=>[e(W,{modelValue:a.value.status,"onUpdate:modelValue":u[12]||(u[12]=s=>a.value.status=s)},{default:l(()=>[(g(!0),N(ne,null,Be(w.value,s=>(g(),y($,{value:s.value,key:s.value},{default:l(()=>[b(B(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1})]),_:1},8,["model","layout","rules"])),[[fe,i.value]]),e(pe,{ref_key:"selectRuleRef",ref:S,onChange:P},null,512)]),_:1},8,["title","width","top","visible"])])}}}),He=V("div",{class:"mt12"},null,-1),Je={class:"m12"},Qe={class:"text-grey"},Ye={class:"text-grey"},Ze={class:"text-grey"},el={class:"text-grey"},al=Y({__name:"list",setup(oe){const{isMobile:U}=Z(ee()),z=Se(),{proxy:E}=H(),{proxy:{$utils:_}}=H(),D=m(),d=m(!0),w=m([]),f=(i=!1)=>{d.value=!0;let n={};v.value!=""&&(n.module=v.value),Oe(n).then(c=>{w.value=c.data.list,i||z.setMenus(c.data.menusList),setTimeout(()=>{d.value=!1},300)}).catch(c=>{_.errorMsg(c),d.value=!1})},x=m([{name:"\u5168\u90E8",value:"all"},{name:"\u7CFB\u7EDF",value:"1"}]);Te(()=>{te(()=>{let i=le().getEnumItem("AppsTypeEnum");for(let n in i)x.value.push(i[n])}),f(!1)});const v=m("all"),O=i=>{v.value=i,f()},a=i=>{var n;(n=E==null?void 0:E.$refs.createComponentRef)==null||n.open(i,v.value)},j=(i,n)=>{n.switch===!0&&(n.loading=!0,d.value=!0,Ge({id:n.id,status:i}).then(c=>{n.loading=!1,f(),_.successMsg(c)}).catch(c=>{n.loading=!1,f(),_.errorMsg(c)}))},q=i=>{Ke({id:i}).then(n=>{f(),_.successMsg(n.message)}).catch(n=>{_.errorMsg(n)})};return(i,n)=>{const c=ae,C=Pe,I=$e,G=Le,K=Ne,S=ue,T=ze,P=je,A=X("permission");return g(),N(ne,null,[V("div",null,[k((g(),y(c,{type:"primary",onClick:n[0]||(n[0]=o=>a(0))},{default:l(()=>[b(" \u6DFB\u52A0\u83DC\u5355 ")]),_:1})),[[A,"system-menus-create"]]),e(Xe,{ref_key:"createComponentRef",ref:D,onSuccess:n[1]||(n[1]=o=>f())},null,512)]),He,e(P,{tabs:x.value,modelValue:v.value,"onUpdate:modelValue":n[2]||(n[2]=o=>v.value=o),loading:d.value,"onUpdate:loading":n[3]||(n[3]=o=>d.value=o),onChange:O},{default:l(()=>[V("div",Je,[e(T,{loading:d.value,data:w.value,"row-key":"id",isLeaf:"",pagination:!1,bordered:!1},{columns:l(()=>[e(C,{title:"\u83DC\u5355\u540D\u79F0","data-index":"menu_name",width:400},{cell:l(({record:o})=>[V("span",Qe,B(o.html),1),V("span",null,B(o.menu_name),1)]),_:1}),e(C,{title:"\u56FE\u6807","data-index":"icon",width:80},{cell:l(({record:o})=>[V("span",{class:qe(["icon",o.icon])},null,2)]),_:1}),e(C,{title:"\u8DEF\u7531\u5730\u5740","data-index":"menu_path",width:160},{cell:l(({record:o})=>[V("span",Ye,B(o.menu_path),1)]),_:1}),e(C,{title:"Api\u63A5\u53E3","data-index":"api_rule",width:160},{cell:l(({record:o})=>[V("span",Ze,B(o.api_rule),1)]),_:1}),e(C,{title:"\u6743\u9650\u6807\u8BC6","data-index":"menu_node",width:160},{cell:l(({record:o})=>[V("span",el,B(o.menu_node),1)]),_:1}),e(C,{title:"\u72B6\u6001",fixed:R(U)?void 0:"right","data-index":"status",align:"center",width:80},{cell:l(({record:o})=>[e(I,{modelValue:o.status.value,"onUpdate:modelValue":F=>o.status.value=F,size:"small",type:"round",loading:o.loading,beforeChange:()=>o.switch=!0,onChange:F=>j(F,o),"checked-value":1,"unchecked-value":0},null,8,["modelValue","onUpdate:modelValue","loading","beforeChange","onChange"])]),_:1},8,["fixed"]),e(C,{title:"\u64CD\u4F5C",fixed:R(U)?void 0:"right",align:"center",width:140},{cell:l(({record:o})=>[e(S,null,{default:l(()=>[k((g(),y(c,{hoverable:!1,onClick:F=>a(o.id),size:"small"},{default:l(()=>[b("\u7F16\u8F91")]),_:2},1032,["onClick"])),[[A,"system-menus-update"]]),k((g(),N("div",null,[e(K,{content:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onOk:F=>q(o.id)},{icon:l(()=>[e(G,{type:"red"})]),default:l(()=>[e(c,{size:"small"},{default:l(()=>[b("\u5220\u9664")]),_:1})]),_:2},1032,["onOk"])])),[[A,"system-menus-delete"]])]),_:2},1024)]),_:1},8,["fixed"])]),_:1},8,["loading","data"])])]),_:1},8,["tabs","modelValue","loading"])],64)}}});export{al as default};
