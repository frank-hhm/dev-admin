import{a4 as te,a5 as le,a3 as ue,a6 as i,bg as xe,a8 as Ce,aa as oe,bA as he,be as ne,aD as d,al as L,ar as l,as as e,aE as _,aK as j,an as w,am as D,aW as Be,bm as De,aq as S,ao as G,aX as se,bB as Ae,bC as ke,au as ye,ad as ie,aF as ce,bp as de,bf as Ve,br as re,bD as we,bE as _e,bF as me,ai as fe,ah as pe,aU as ve,aV as Ee,av as ge,bG as $e,ax as Se,b9 as Re,bH as Ie,ac as Me,bI as Ue,bs as Le,bt as Te,b5 as ze,b3 as Oe,bJ as Pe,bz as qe,ap as V,bK as Ne,bL as je,bM as Ge,b1 as He,b4 as Ke}from"./index.b04076a2.js";/* empty css              */import{e as Je}from"./role.6732c049.js";const We={key:0,class:"text-red"},Xe={key:1,class:"text-red"},Qe={name:"systemAdminCreate"},Ye=te({...Qe,emits:["success"],setup(be,{expose:T,emit:q}){const{isMobile:R}=le(ue()),{proxy:m,proxy:{$utils:g}}=ge(),h=i("80px"),b=q;i(xe().getEnumItem("system.admin.StatusEnum"));const I=i("create"),F=i(0),E=i(1),$=i(!1),x=i(),n=i({account:"",real_name:"",avatar:"",roles:[],pwd:"",conf_pwd:"",status:1}),p=Ce({account:[{required:!0,message:"\u8D26\u53F7\u4E0D\u80FD\u4E3A\u7A7A\uFF01",trigger:"blur"}],real_name:[{required:!0,message:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A\uFF01",trigger:"blur"}]}),M=i(!1),H=()=>{!F.value||(M.value=!0,$e({id:F.value}).then(o=>{n.value.account=o.data.account,n.value.real_name=o.data.real_name,n.value.avatar=o.data.avatar,E.value=o.data.level,n.value.status=o.data.status.value,n.value.roles=o.data.roles,M.value=!1}).catch(o=>{g.errorMsg(o)}))},A=i(!1),c=()=>{var o;(o=m==null?void 0:m.$refs.createRef)==null||o.validate((t,k)=>{if(!t){if(A.value)return;A.value=!0;let f=null;I.value=="create"?f=Ae(n.value):f=ke(Object.assign({id:F.value},n.value)),f.then(v=>{g.successMsg(v.message),r(),b("success"),A.value=!1}).catch(v=>{g.errorMsg(v),A.value=!1})}})},a=(o=0,t)=>{E.value=1,o!=0?(I.value="update",F.value=o):(I.value="create",p.pwd=[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}],p.conf_pwd=[{required:!0,message:"\u8BF7\u518D\u6B21\u5BC6\u7801",trigger:"blur"}]),ye(()=>{H()}),$.value=!0},r=()=>{var o;return(o=m==null?void 0:m.$refs.createRef)==null||o.resetFields(),F.value=0,p.pwd=[],p.conf_pwd=[],$.value=!1,!0},U=i([]),z=()=>{Je().then(o=>{U.value=o.data}).catch(o=>{g.errorMsg(o)})};return oe(()=>{z()}),T({open:a}),(o,t)=>{const k=ie,f=ce,v=de,K=Ve,O=re,P=we,J=he,W=_e,C=me,X=fe,N=pe,Q=ve,Y=Ee,Z=ne("loading");return d(),L("div",null,[l(Y,{title:I.value=="create"?"\u6DFB\u52A0\u8D26\u53F7":"\u7F16\u8F91\u8D26\u53F7",onBeforeOk:c,onBeforeCancel:r,width:w(R)?"calc(100% - 20px)":"800px",top:w(se)().ModalTop,class:"modal",visible:$.value,"onUpdate:visible":t[9]||(t[9]=s=>$.value=s),"align-center":!1,"title-align":"start","render-to-body":""},{footer:e(()=>[l(Q,null,{default:e(()=>[l(N,{onClick:t[7]||(t[7]=s=>r())},{default:e(()=>[_("\u53D6\u6D88")]),_:1}),l(N,{type:"primary",onClick:t[8]||(t[8]=s=>c()),loading:A.value,disabled:M.value||A.value},{default:e(()=>[_("\u786E\u5B9A")]),_:1},8,["loading","disabled"])]),_:1})]),default:e(()=>[j((d(),L("div",null,[l(X,{model:n.value,layout:w(R)?"vertical":"horizontal",ref_key:"createRef",ref:x,rules:p},{default:e(()=>[l(O,{gutter:20},{default:e(()=>[l(v,{md:12,xs:24},{default:e(()=>[l(f,{"label-col-flex":h.value,label:"\u59D3\u540D",field:"real_name"},{default:e(()=>[l(k,{modelValue:n.value.real_name,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.real_name=s),placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D"},null,8,["modelValue"])]),_:1},8,["label-col-flex"]),l(f,{"label-col-flex":h.value,label:"\u8D26\u53F7",field:"account"},{default:e(()=>[l(k,{modelValue:n.value.account,"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.account=s),placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),l(v,{md:12,xs:24},{default:e(()=>[l(f,{"label-col-flex":h.value,label:"\u5934\u50CF",field:"avatar"},{default:e(()=>[l(K,{modelValue:n.value.avatar,"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.avatar=s),count:"1"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),l(O,{gutter:20},{default:e(()=>[E.value?(d(),D(v,{key:0,md:12,xs:24},{default:e(()=>[l(f,{"label-col-flex":h.value,label:"\u89D2\u8272",field:"roles"},{default:e(()=>[l(J,{modelValue:n.value.roles,"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.roles=s),multiple:"","collapse-tags":"",placeholder:"\u9009\u62E9\u89D2\u8272",class:"form-select-fil",onChange:t[4]||(t[4]=s=>o.$forceUpdate())},{default:e(()=>[(d(!0),L(Be,null,De(U.value,s=>(d(),D(P,{key:s.id,value:s.id},{default:e(()=>[_(S(s.role_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})):(d(),D(v,{key:1,md:12,xs:24},{default:e(()=>[l(f,{"label-col-flex":h.value,label:"\u89D2\u8272\uFF1A"},{default:e(()=>[E.value==0?(d(),L("div",We,[l(W),_("\u8D85\u7EA7\u7BA1\u7406\u5458")])):G("",!0),E.value==-1?(d(),L("div",Xe,[l(C),_("\u5F00\u53D1\u8005")])):G("",!0)]),_:1},8,["label-col-flex"])]),_:1}))]),_:1}),l(O,{gutter:20},{default:e(()=>[l(v,{md:12,xs:24},{default:e(()=>[l(f,{"label-col-flex":h.value,label:"\u5BC6\u7801\uFF1A",field:"pwd"},{default:e(()=>[l(k,{modelValue:n.value.pwd,"onUpdate:modelValue":t[5]||(t[5]=s=>n.value.pwd=s),type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),l(v,{md:12,xs:24},{default:e(()=>[l(f,{"label-col-flex":h.value,label:"\u786E\u5B9A\u5BC6\u7801\uFF1A",field:"conf_pwd"},{default:e(()=>[l(k,{modelValue:n.value.conf_pwd,"onUpdate:modelValue":t[6]||(t[6]=s=>n.value.conf_pwd=s),type:"password",placeholder:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1})]),_:1},8,["model","layout","rules"])])),[[Z,M.value]])]),_:1},8,["title","width","top","visible"])])}}}),Ze=V("div",{class:"mt12"},null,-1),el={class:"admin-box"},ll={class:"text-grey"},al={class:"text-grey"},tl={class:"text-grey"},ul={key:1},il=te({__name:"list",setup(be){const T=i("50px"),{adminInfo:q}=le(Se()),{isMobile:R}=le(ue()),{proxy:m,proxy:{$utils:g}}=ge(),h=i(),b=i({account_like:"",time:[]}),I=()=>{var c;(c=m==null?void 0:m.$refs.searchFormRef)==null||c.resetFields(),b.value.time=[],x(!0)},F=i(!0),E=i(),$=i([]),x=(c=!1)=>{c&&(p.value.page=1);let a={};a.page=p.value.page,a.limit=p.value.limit,a.account_like=b.value.account_like,a.time=b.value.time,F.value=!0,Pe(a).then(r=>{F.value=!1,$.value=r.data.data,p.value.total=r.data.total,setTimeout(()=>{F.value=!1},300)}).catch(r=>{g.errorMsg(r)})},n=c=>{var a;(a=m==null?void 0:m.$refs.createComponentRef)==null||a.open(c,1)},p=i({total:0,limit:se().PageLimit.value,page:1}),M=c=>{p.value=c,x()},H=c=>{Ne({id:c}).then(a=>{x(),g.successMsg(a.message)}).catch(a=>{g.errorMsg(a)})},A=(c,a)=>{a.switch===!0&&(a.loading=!0,je({id:a.id,status:c}).then(r=>{a.loading=!1,x(),g.successMsg(r)}).catch(r=>{a.loading=!1,x(),g.errorMsg(r)}))};return oe(()=>{x()}),(c,a)=>{const r=ie,U=ce,z=de,o=Ge,t=pe,k=ve,f=re,v=fe,K=Re,O=me,P=Ie,J=_e,W=Me,C=He,X=Ue,N=Le,Q=Te,Y=ze,Z=Oe,s=Ke,Fe=qe,ee=ne("permission");return d(),D(Fe,{pageHeader:"",header:""},{header:e(()=>[l(K,{class:"card-form"},{default:e(()=>[l(v,{layout:w(R)?"vertical":"horizontal",model:b.value,ref_key:"searchFormRef",ref:h},{default:e(()=>[l(f,{gutter:20},{default:e(()=>[l(z,{md:8,xs:24,xl:6},{default:e(()=>[l(U,{"label-col-flex":T.value,label:"\u8D26\u53F7",prop:"account_like"},{default:e(()=>[l(r,{class:"form-input-inline",modelValue:b.value.account_like,"onUpdate:modelValue":a[0]||(a[0]=B=>b.value.account_like=B),placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u624B\u673A\u53F7","allow-clear":""},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),l(z,{md:8,xs:24,xl:8},{default:e(()=>[l(U,{"label-col-flex":T.value,label:"\u6CE8\u518C\u65F6\u95F4",prop:"create_time"},{default:e(()=>[l(o,{modelValue:b.value.time,"onUpdate:modelValue":a[1]||(a[1]=B=>b.value.time=B),btnShortcuts:!1},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),l(z,{md:12,xs:24,xl:8},{default:e(()=>[l(U,{"label-col-flex":T.value,"hide-label":""},{default:e(()=>[l(k,null,{default:e(()=>[l(t,{onClick:a[2]||(a[2]=B=>x())},{default:e(()=>[_("\u67E5\u8BE2")]),_:1}),l(t,{plain:"",onClick:a[3]||(a[3]=B=>I())},{default:e(()=>[_("\u91CD\u7F6E")]),_:1})]),_:1})]),_:1},8,["label-col-flex"])]),_:1})]),_:1})]),_:1},8,["layout","model"])]),_:1}),Ze]),"page-header-left":e(()=>[_(" \u5217\u8868 ")]),"page-header-right":e(()=>[l(Ye,{ref_key:"createComponentRef",ref:E,onSuccess:a[4]||(a[4]=B=>x(!0))},null,512),j((d(),D(t,{type:"text",size:"small",onClick:a[5]||(a[5]=B=>n(0))},{default:e(()=>[_("\u6DFB\u52A0\u8D26\u53F7")]),_:1})),[[ee,"system-admin-create"]])]),content:e(({height:B})=>[l(Z,{loading:F.value,data:$.value,"row-key":"id",isLeaf:"",pagination:!1,scroll:{x:"100%",y:B-39},"table-layout-fixed":!0},{empty:e(()=>[]),columns:e(()=>[l(C,{title:"\u7EA7\u522B","data-index":"level",align:"left",width:120},{cell:e(({record:u})=>[u.level==-1?(d(),D(P,{key:0},{icon:e(()=>[l(O)]),default:e(()=>[_("\u5F00\u53D1\u8005")]),_:1})):u.level==0?(d(),D(P,{key:1},{icon:e(()=>[l(J)]),default:e(()=>[_("\u8D85\u7EA7\u7BA1\u7406\u5458")]),_:1})):(d(),D(P,{key:2},{icon:e(()=>[l(W)]),default:e(()=>[_("\u7BA1\u7406\u5458")]),_:1}))]),_:1}),l(C,{title:"\u5934\u50CF","data-index":"avatar",align:"center",width:80},{cell:e(({record:u})=>[l(X,{src:u.avatar,height:32,width:32},null,8,["src"])]),_:1}),l(C,{title:"\u8D26\u53F7","data-index":"account",width:120},{cell:e(({record:u})=>[V("div",el,[V("div",null,S(u.account),1),V("div",ll,S(u.real_name),1)])]),_:1}),l(C,{title:"\u767B\u5F55\u6B21\u6570","data-index":"login_count",align:"center",width:100},{cell:e(({record:u})=>[V("div",null,S(u.login_count),1)]),_:1}),l(C,{title:"\u6700\u540E\u4E00\u6B21\u767B\u5F55\u65F6\u95F4","data-index":"last_time",align:"center",width:160},{cell:e(({record:u})=>[V("div",al,S(u.last_time),1)]),_:1}),l(C,{title:"\u6700\u540E\u4E00\u6B21\u767B\u5F55IP","data-index":"last_ip",width:160},{cell:e(({record:u})=>{var y,ae;return[V("div",null,S((y=u.last_ip)==null?void 0:y.value),1),V("div",tl,S((ae=u.last_ip)==null?void 0:ae.text),1)]}),_:1}),l(C,{title:"\u72B6\u6001",fixed:w(R)?void 0:"right","data-index":"status",align:"center",width:80},{cell:e(({record:u})=>[l(N,{modelValue:u.status.value,"onUpdate:modelValue":y=>u.status.value=y,disabled:u.level<1,size:"small",type:"round",loading:u.loading,beforeChange:()=>u.switch=!0,onChange:y=>A(y,u),"checked-value":1,"unchecked-value":0},null,8,["modelValue","onUpdate:modelValue","disabled","loading","beforeChange","onChange"])]),_:1},8,["fixed"]),l(C,{title:"\u64CD\u4F5C",fixed:w(R)?void 0:"right",align:"center",width:140},{cell:e(({record:u})=>[l(k,null,{default:e(()=>[Number(w(q).level)<1||w(q).id==u.id?j((d(),D(t,{key:0,onClick:y=>n(u.id),size:"small"},{default:e(()=>[_("\u7F16\u8F91")]),_:2},1032,["onClick"])),[[ee,"system-admin-update"]]):G("",!0),u.level>0?j((d(),L("div",ul,[l(Y,{content:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onOk:y=>H(u.id)},{icon:e(()=>[l(Q,{type:"red"})]),default:e(()=>[l(t,{size:"small"},{default:e(()=>[_("\u5220\u9664")]),_:1})]),_:2},1032,["onOk"])])),[[ee,"system-admin-delete"]]):G("",!0)]),_:2},1024)]),_:1},8,["fixed"])]),_:2},1032,["loading","data","scroll"])]),footer:e(()=>[l(s,{listPage:p.value,onChange:M},null,8,["listPage"])]),_:1})}}});export{il as default};
