import{a4 as J,a6 as c,ba as Q,a8 as re,ad as _e,bb as pe,bc as fe,ac as ve,ah as Y,ab as H,bd as be,ai as ge,aU as Z,aV as Ce,b8 as P,al as $,ar as e,as as l,an as xe,be as Fe,bf as Ve,au as ee,av as W,aD as g,aK as B,am as E,aE as b,ao as he,aW as le,bg as Ee,aq as D,aX as ye,bh as De,bi as Be,aF as ke,bj as Ae,bk as Me,bl as Ue,ay as Re,aa as we,bm as Ie,bn as Se,a_ as Te,bo as $e,ap as V,bp as Le,bq as Ne,aN as Oe,br as je,bs as ze,bt as qe}from"./index.f27941d7.js";const Ge={name:"menusCreateComponent"},Ke=J({...Ge,emits:["success"],setup(ae,{expose:L,emit:k}){const{proxy:p,proxy:{$utils:y}}=W(),d=c("60px"),U=c(Q().getEnumItem("StatusEnum")),f=c("create"),C=c(0),v=c(!1),N=c(),a=c({module:1,type:1,menu_name:"",pid:null,menu_path:"",menu_node:"",params:"",icon:"",sort:0,status:1,api_rule:""}),O=()=>{z(),C.value&&(i.value=!0,De({id:C.value}).then(t=>{a.value.type=Number(t.data.type),a.value.module=Number(t.data.module),a.value.menu_name=t.data.menu_name,t.data.pid>0&&(a.value.pid=Number(t.data.pid)),a.value.menu_path=t.data.menu_path,a.value.menu_node=t.data.menu_node,a.value.params=t.data.params,a.value.icon=t.data.icon,a.value.sort=t.data.sort,a.value.status=t.data.status.value,a.value.api_rule=t.data.api_rule,i.value=!1}).catch(t=>{y.errorMsg(t)}))},j=re({menu_name:[{required:!0,message:"\u83DC\u5355\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01"}]}),i=c(!1),n=k,m=c(!1),x=()=>{var t;(t=p==null?void 0:p.$refs.createRef)==null||t.validate((u,h)=>{if(!u){if(m.value)return;m.value=!0;let r=null;f.value=="create"?r=Fe(a.value):r=Ve(Object.assign({id:C.value},a.value)),r.then(_=>{y.successMsg(_.message),F(),n("success"),m.value=!1}).catch(_=>{y.errorMsg(_),m.value=!1})}})},R=c([]),z=()=>{let t={};C.value&&(t.pid=C.value),Be(t).then(u=>{R.value=u.data.menuList}).catch(u=>{y.errorMsg(u)})},q=t=>{},w=c(),I=c(),G=t=>{a.value.api_rule=t.rule},A=t=>{a.value.icon=t},o=(t=0,u)=>{t!=0?(f.value="update",C.value=t):f.value="create",u!="all"&&(a.value.module=u),ee(()=>{O()}),v.value=!0},F=()=>{var t;return(t=p==null?void 0:p.$refs.createRef)==null||t.resetFields(),C.value=0,v.value=!1,!0};return L({open:o}),(t,u)=>{const h=_e,r=ke,_=Ae,S=pe,K=Me,ue=fe,te=ve,T=Y,ne=H("select-icon-modal"),M=Ue,oe=be,se=ge,de=Z,ie=H("select-rule-modal"),me=Ce,ce=P("loading"),X=P("btn");return g(),$("div",null,[e(me,{title:f.value=="create"?"\u6DFB\u52A0\u83DC\u5355":"\u7F16\u8F91\u83DC\u5355",onBeforeOk:x,onBeforeCancel:F,width:"900px",top:xe(ye)().ModalTop,class:"modal",visible:v.value,"onUpdate:visible":u[13]||(u[13]=s=>v.value=s),"align-center":!1,"title-align":"start","render-to-body":""},{footer:l(()=>[e(de,null,{default:l(()=>[B((g(),E(T,{onClick:F},{default:l(()=>[b("\u53D6\u6D88")]),_:1})),[[X]]),B((g(),E(T,{type:"primary",disabled:i.value||m.value,loading:i.value,onClick:x},{default:l(()=>[b("\u786E\u5B9A")]),_:1},8,["disabled","loading"])),[[X]])]),_:1})]),default:l(()=>[B((g(),E(se,{model:a.value,ref_key:"createRef",ref:N,rules:j},{default:l(()=>[e(M,{gutter:20},{default:l(()=>[e(_,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u83DC\u5355\u540D\u79F0",field:"menu_name"},{default:l(()=>[e(h,{modelValue:a.value.menu_name,"onUpdate:modelValue":u[0]||(u[0]=s=>a.value.menu_name=s),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6A21\u5757",field:"module"},{default:l(()=>[e(K,{modelValue:a.value.module,"onUpdate:modelValue":u[1]||(u[1]=s=>a.value.module=s)},{default:l(()=>[e(S,{value:1},{default:l(()=>[b("\u7CFB\u7EDF")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u7C7B\u578B",field:"type"},{default:l(()=>[e(K,{modelValue:a.value.type,"onUpdate:modelValue":u[2]||(u[2]=s=>a.value.type=s)},{default:l(()=>[e(S,{value:1},{default:l(()=>[b("\u83DC\u5355")]),_:1}),e(S,{value:2},{default:l(()=>[b("\u4E8B\u4EF6")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u7236\u7EA7\u5206\u7C7B",field:"pid"},{default:l(()=>[e(ue,{modelValue:a.value.pid,"onUpdate:modelValue":u[3]||(u[3]=s=>a.value.pid=s),options:R.value,onChange:q,"allow-search":"","allow-clear":"",class:"form-select-fil","check-strictly":"",placeholder:"\u8BF7\u9009\u62E9\u7236\u7EA7\u5206\u7C7B"},null,8,["modelValue","options"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u56FE\u6807",field:"icon",class:"default-append"},{default:l(()=>[e(h,{modelValue:a.value.icon,"onUpdate:modelValue":u[5]||(u[5]=s=>a.value.icon=s),placeholder:"\u9009\u62E9\u56FE\u6807"},{prefix:l(()=>[e(te)]),append:l(()=>[e(T,{onClick:u[4]||(u[4]=()=>{I.value.open()})},{default:l(()=>[b(" \u56FE\u6807 ")]),_:1}),e(ne,{ref_key:"selectModalIconRef",ref:I,onChange:A},null,512)]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[a.value.type!=3?(g(),E(_,{key:0,md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u8DEF\u7531\u5730\u5740",field:"menu_path"},{default:l(()=>[e(h,{modelValue:a.value.menu_path,"onUpdate:modelValue":u[6]||(u[6]=s=>a.value.menu_path=s),placeholder:"\u8BF7\u8F93\u5165\u8DEF\u7531\u5730\u5740"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})):he("",!0),e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u63A5\u53E3",field:"api_rule",class:"default-append"},{default:l(()=>[e(h,{disabled:"",modelValue:a.value.api_rule,"onUpdate:modelValue":u[8]||(u[8]=s=>a.value.api_rule=s),placeholder:"\u8BF7\u9009\u62E9\u63A5\u53E3"},{append:l(()=>[e(T,{onClick:u[7]||(u[7]=()=>{w.value.open()})},{default:l(()=>[b(" \u63A5\u53E3 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6743\u9650\u6807\u8BC6",field:"menu_node"},{default:l(()=>[e(h,{modelValue:a.value.menu_node,"onUpdate:modelValue":u[9]||(u[9]=s=>a.value.menu_node=s),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u6807\u8BC6"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(_,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u53C2\u6570",field:"params"},{default:l(()=>[e(h,{modelValue:a.value.params,"onUpdate:modelValue":u[10]||(u[10]=s=>a.value.params=s)},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6392\u5E8F\uFF1A",field:"sort"},{default:l(()=>[e(oe,{modelValue:a.value.sort,"onUpdate:modelValue":u[11]||(u[11]=s=>a.value.sort=s),min:0,max:1e4},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u72B6\u6001",field:"status"},{default:l(()=>[e(K,{modelValue:a.value.status,"onUpdate:modelValue":u[12]||(u[12]=s=>a.value.status=s)},{default:l(()=>[(g(!0),$(le,null,Ee(U.value,s=>(g(),E(S,{value:s.value,key:s.value},{default:l(()=>[b(D(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[ce,i.value]]),e(ie,{ref_key:"selectRuleRef",ref:w,onChange:G},null,512)]),_:1},8,["title","top","visible"])])}}}),Pe=V("div",{class:"mt12"},null,-1),We={class:"m12"},Xe={class:"text-grey"},He={class:"text-grey"},Je={class:"text-grey"},Qe={class:"text-grey"},Ze=J({__name:"list",setup(ae){const L=Re(),{proxy:k}=W(),{proxy:{$utils:p}}=W(),y=c(),d=c(!0),U=c([]),f=(i=!1)=>{d.value=!0;let n={};v.value!=""&&(n.module=v.value),Le(n).then(m=>{U.value=m.data.list,i||L.setMenus(m.data.menusList),setTimeout(()=>{d.value=!1},300)}).catch(m=>{p.errorMsg(m),d.value=!1})},C=c([{name:"\u5168\u90E8",value:"all"},{name:"\u7CFB\u7EDF",value:"1"}]);we(()=>{ee(()=>{let i=Q().getEnumItem("AppsTypeEnum");for(let n in i)C.value.push(i[n])}),f(!0)});const v=c("all"),N=i=>{v.value=i,f()},a=i=>{var n;(n=k==null?void 0:k.$refs.createComponentRef)==null||n.open(i,v.value)},O=(i,n)=>{n.switch===!0&&(n.loading=!0,d.value=!0,je({id:n.id,status:i}).then(m=>{n.loading=!1,f(),p.successMsg(m)}).catch(m=>{n.loading=!1,f(),p.errorMsg(m)}))},j=i=>{ze({id:i}).then(n=>{f(),p.successMsg(n.message)}).catch(n=>{p.errorMsg(n)})};return(i,n)=>{const m=Y,x=qe,R=Ie,z=Se,q=Te,w=Z,I=$e,G=Ne,A=P("permission");return g(),$(le,null,[V("div",null,[B((g(),E(m,{type:"primary",onClick:n[0]||(n[0]=o=>a(0))},{default:l(()=>[b(" \u6DFB\u52A0\u83DC\u5355 ")]),_:1})),[[A,"system-menus-create"]]),e(Ke,{ref_key:"createComponentRef",ref:y,onSuccess:n[1]||(n[1]=o=>f())},null,512)]),Pe,e(G,{tabs:C.value,modelValue:v.value,"onUpdate:modelValue":n[2]||(n[2]=o=>v.value=o),loading:d.value,"onUpdate:loading":n[3]||(n[3]=o=>d.value=o),onChange:N},{default:l(()=>[V("div",We,[e(I,{loading:d.value,data:U.value,"row-key":"id",isLeaf:"",pagination:!1,bordered:!1},{columns:l(()=>[e(x,{title:"\u83DC\u5355\u540D\u79F0","data-index":"menu_name",width:400},{cell:l(({record:o})=>[V("span",Xe,D(o.html),1),V("span",null,D(o.menu_name),1)]),_:1}),e(x,{title:"\u56FE\u6807","data-index":"icon",width:80},{cell:l(({record:o})=>[V("span",{class:Oe(["icon",o.icon])},null,2)]),_:1}),e(x,{title:"\u8DEF\u7531\u5730\u5740","data-index":"menu_path",width:160},{cell:l(({record:o})=>[V("span",He,D(o.menu_path),1)]),_:1}),e(x,{title:"Api\u63A5\u53E3","data-index":"api_rule",width:160},{cell:l(({record:o})=>[V("span",Je,D(o.api_rule),1)]),_:1}),e(x,{title:"\u6743\u9650\u6807\u8BC6","data-index":"menu_node",width:160},{cell:l(({record:o})=>[V("span",Qe,D(o.menu_node),1)]),_:1}),e(x,{title:"\u72B6\u6001",fixed:"right","data-index":"status",align:"center",width:80},{cell:l(({record:o})=>[e(R,{modelValue:o.status.value,"onUpdate:modelValue":F=>o.status.value=F,size:"small",type:"round",loading:o.loading,beforeChange:()=>o.switch=!0,onChange:F=>O(F,o),"checked-value":1,"unchecked-value":0},null,8,["modelValue","onUpdate:modelValue","loading","beforeChange","onChange"])]),_:1}),e(x,{title:"\u64CD\u4F5C",fixed:"right",align:"center",width:140},{cell:l(({record:o})=>[e(w,null,{default:l(()=>[B((g(),E(m,{hoverable:!1,onClick:F=>a(o.id),size:"small"},{default:l(()=>[b("\u7F16\u8F91")]),_:2},1032,["onClick"])),[[A,"system-menus-update"]]),B((g(),$("div",null,[e(q,{content:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onOk:F=>j(o.id)},{icon:l(()=>[e(z,{type:"red"})]),default:l(()=>[e(m,{size:"small"},{default:l(()=>[b("\u5220\u9664")]),_:1})]),_:2},1032,["onOk"])])),[[A,"system-menus-delete"]])]),_:2},1024)]),_:1})]),_:1},8,["loading","data"])])]),_:1},8,["tabs","modelValue","loading"])],64)}}});export{Ze as default};
