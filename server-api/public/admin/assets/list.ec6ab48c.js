import{_ as re}from"./LayoutBodyTabs.680336c5.js";import{a4 as J,a6 as m,bb as K,a8 as _e,ad as pe,bc as fe,bd as ve,ac as be,ah as Q,ab as H,be as ge,ai as Ce,aW as Z,aX as xe,b9 as W,al as T,ar as e,as as l,an as Fe,bf as Ve,bg as he,au as ee,av as X,aD as g,aN as B,am as E,aE as b,ao as Ee,aM as le,bh as ye,aq as D,aY as De,bi as Be,bj as ke,aF as Ae,bk as Me,bl as Re,bm as Ue,ay as we,aa as Ie,bn as Se,bo as $e,a$ as Te,bp as Le,ap as V,bq as Ne,aP as Oe,br as je,bs as ze,bt as qe}from"./index.0da99daf.js";const Pe={name:"menusCreateComponent"},Ge=J({...Pe,emits:["success"],setup(ae,{expose:L,emit:k}){const{proxy:p,proxy:{$utils:y}}=X(),d=m("60px"),R=m(K().getEnumItem("StatusEnum")),f=m("create"),C=m(0),v=m(!1),N=m(),a=m({module:1,type:1,menu_name:"",pid:null,menu_path:"",menu_node:"",params:"",icon:"",sort:0,status:1,api_rule:""}),O=()=>{z(),C.value&&(i.value=!0,Be({id:C.value}).then(t=>{a.value.type=t.data.type,a.value.menu_name=t.data.menu_name,a.value.pid=t.data.pid,a.value.menu_path=t.data.menu_path,a.value.menu_node=t.data.menu_node,a.value.params=t.data.params,a.value.icon=t.data.icon,a.value.sort=t.data.sort,a.value.status=t.data.status.value,a.value.api_rule=t.data.api_rule,i.value=!1}).catch(t=>{y.errorMsg(t)}))},j=_e({menu_name:[{required:!0,message:"\u83DC\u5355\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01"}]}),i=m(!1),n=k,c=m(!1),x=()=>{var t;(t=p==null?void 0:p.$refs.createRef)==null||t.validate((u,h)=>{if(!u){if(c.value)return;c.value=!0;let r=null;f.value=="create"?r=Ve(a.value):r=he(Object.assign({id:C.value},a.value)),r.then(_=>{y.successMsg(_.message),F(),n("success"),c.value=!1}).catch(_=>{y.errorMsg(_),c.value=!1})}})},U=m([]),z=()=>{let t={};C.value&&(t.pid=C.value),ke(t).then(u=>{U.value=u.data.menuList}).catch(u=>{y.errorMsg(u)})},q=t=>{},w=m(),I=m(),P=t=>{a.value.api_rule=t.rule},A=t=>{a.value.icon=t},o=(t=0,u)=>{t!=0?(f.value="update",C.value=t):f.value="create",u!="all"&&(a.value.module=u),ee(()=>{O()}),v.value=!0},F=()=>{var t;return(t=p==null?void 0:p.$refs.createRef)==null||t.resetFields(),C.value=0,v.value=!1,!0};return L({open:o}),(t,u)=>{const h=pe,r=Ae,_=Me,S=fe,G=Re,ue=ve,te=be,$=Q,ne=H("select-icon-modal"),M=Ue,oe=ge,se=Ce,de=Z,ie=H("select-rule-modal"),ce=xe,me=W("loading"),Y=W("btn");return g(),T("div",null,[e(ce,{title:f.value=="create"?"\u6DFB\u52A0\u83DC\u5355":"\u7F16\u8F91\u83DC\u5355",onBeforeOk:x,onBeforeCancel:F,width:"900px",top:Fe(De)().ModalTop,class:"modal",visible:v.value,"onUpdate:visible":u[13]||(u[13]=s=>v.value=s),"align-center":!1,"title-align":"start","render-to-body":""},{footer:l(()=>[e(de,null,{default:l(()=>[B((g(),E($,{onClick:F},{default:l(()=>[b("\u53D6\u6D88")]),_:1})),[[Y]]),B((g(),E($,{type:"primary",disabled:i.value||c.value,loading:i.value,onClick:x},{default:l(()=>[b("\u786E\u5B9A")]),_:1},8,["disabled","loading"])),[[Y]])]),_:1})]),default:l(()=>[B((g(),E(se,{model:a.value,ref_key:"createRef",ref:N,rules:j},{default:l(()=>[e(M,{gutter:20},{default:l(()=>[e(_,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u83DC\u5355\u540D\u79F0",field:"menu_name"},{default:l(()=>[e(h,{modelValue:a.value.menu_name,"onUpdate:modelValue":u[0]||(u[0]=s=>a.value.menu_name=s),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6A21\u5757",field:"module"},{default:l(()=>[e(G,{modelValue:a.value.module,"onUpdate:modelValue":u[1]||(u[1]=s=>a.value.module=s)},{default:l(()=>[e(S,{value:1},{default:l(()=>[b("\u7CFB\u7EDF")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u7C7B\u578B",field:"type"},{default:l(()=>[e(G,{modelValue:a.value.type,"onUpdate:modelValue":u[2]||(u[2]=s=>a.value.type=s)},{default:l(()=>[e(S,{value:1},{default:l(()=>[b("\u83DC\u5355")]),_:1}),e(S,{value:2},{default:l(()=>[b("\u4E8B\u4EF6")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u7236\u7EA7\u5206\u7C7B",field:"pid"},{default:l(()=>[e(ue,{modelValue:a.value.pid,"onUpdate:modelValue":u[3]||(u[3]=s=>a.value.pid=s),options:U.value,onChange:q,"allow-search":"","allow-clear":"",class:"form-select-fil","check-strictly":"",placeholder:"\u8BF7\u9009\u62E9\u7236\u7EA7\u5206\u7C7B"},null,8,["modelValue","options"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u56FE\u6807",field:"icon",class:"default-append"},{default:l(()=>[e(h,{modelValue:a.value.icon,"onUpdate:modelValue":u[5]||(u[5]=s=>a.value.icon=s),placeholder:"\u9009\u62E9\u56FE\u6807"},{prefix:l(()=>[e(te)]),append:l(()=>[e($,{onClick:u[4]||(u[4]=()=>{I.value.open()})},{default:l(()=>[b(" \u56FE\u6807 ")]),_:1}),e(ne,{ref_key:"selectModalIconRef",ref:I,onChange:A},null,512)]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[a.value.type!=3?(g(),E(_,{key:0,md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u8DEF\u7531\u5730\u5740",field:"menu_path"},{default:l(()=>[e(h,{modelValue:a.value.menu_path,"onUpdate:modelValue":u[6]||(u[6]=s=>a.value.menu_path=s),placeholder:"\u8BF7\u8F93\u5165\u8DEF\u7531\u5730\u5740"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})):Ee("",!0),e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u63A5\u53E3",field:"api_rule",class:"default-append"},{default:l(()=>[e(h,{disabled:"",modelValue:a.value.api_rule,"onUpdate:modelValue":u[8]||(u[8]=s=>a.value.api_rule=s),placeholder:"\u8BF7\u9009\u62E9\u63A5\u53E3"},{append:l(()=>[e($,{onClick:u[7]||(u[7]=()=>{w.value.open()})},{default:l(()=>[b(" \u63A5\u53E3 ")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6743\u9650\u6807\u8BC6",field:"menu_node"},{default:l(()=>[e(h,{modelValue:a.value.menu_node,"onUpdate:modelValue":u[9]||(u[9]=s=>a.value.menu_node=s),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u6807\u8BC6"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(_,{md:24,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u53C2\u6570",field:"params"},{default:l(()=>[e(h,{modelValue:a.value.params,"onUpdate:modelValue":u[10]||(u[10]=s=>a.value.params=s)},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u6392\u5E8F\uFF1A",field:"sort"},{default:l(()=>[e(oe,{modelValue:a.value.sort,"onUpdate:modelValue":u[11]||(u[11]=s=>a.value.sort=s),min:0,max:1e4},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),e(M,{gutter:20},{default:l(()=>[e(_,{md:12,xs:24},{default:l(()=>[e(r,{"label-col-flex":d.value,label:"\u72B6\u6001",field:"status"},{default:l(()=>[e(G,{modelValue:a.value.status,"onUpdate:modelValue":u[12]||(u[12]=s=>a.value.status=s)},{default:l(()=>[(g(!0),T(le,null,ye(R.value,s=>(g(),E(S,{value:s.value,key:s.value},{default:l(()=>[b(D(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[me,i.value]]),e(ie,{ref_key:"selectRuleRef",ref:w,onChange:P},null,512)]),_:1},8,["title","top","visible"])])}}}),We=V("div",{class:"mt12"},null,-1),Xe={class:"m12"},Ye={class:"text-grey"},He={class:"text-grey"},Je={class:"text-grey"},Ke={class:"text-grey"},el=J({__name:"list",setup(ae){const L=we(),{proxy:k}=X(),{proxy:{$utils:p}}=X(),y=m(),d=m(!0),R=m([]),f=(i=!1)=>{d.value=!0;let n={};v.value!=""&&(n.module=v.value),Ne(n).then(c=>{R.value=c.data.list,i&&L.setMenus(c.data.menusList),setTimeout(()=>{d.value=!1},300)}).catch(c=>{p.errorMsg(c),d.value=!1})},C=m([{name:"\u5168\u90E8",value:"all"},{name:"\u7CFB\u7EDF",value:"1"}]);Ie(()=>{ee(()=>{let i=K().getEnumItem("AppsTypeEnum");for(let n in i)C.value.push(i[n])}),f()});const v=m("all"),N=i=>{v.value=i,f()},a=i=>{var n;(n=k==null?void 0:k.$refs.createComponentRef)==null||n.open(i,v.value)},O=(i,n)=>{n.switch===!0&&(n.loading=!0,d.value=!0,je({id:n.id,status:i}).then(c=>{n.loading=!1,f(!0),p.successMsg(c)}).catch(c=>{n.loading=!1,f(),p.errorMsg(c)}))},j=i=>{ze({id:i}).then(n=>{f(!0),p.successMsg(n.message)}).catch(n=>{p.errorMsg(n)})};return(i,n)=>{const c=Q,x=qe,U=Se,z=$e,q=Te,w=Z,I=Le,P=re,A=W("permission");return g(),T(le,null,[V("div",null,[B((g(),E(c,{type:"primary",onClick:n[0]||(n[0]=o=>a(0))},{default:l(()=>[b(" \u6DFB\u52A0\u83DC\u5355 ")]),_:1})),[[A,"system-menus-create"]]),e(Ge,{ref_key:"createComponentRef",ref:y,onSuccess:n[1]||(n[1]=o=>f(!0))},null,512)]),We,e(P,{tabs:C.value,modelValue:v.value,"onUpdate:modelValue":n[2]||(n[2]=o=>v.value=o),loading:d.value,"onUpdate:loading":n[3]||(n[3]=o=>d.value=o),onChange:N},{default:l(()=>[V("div",Xe,[e(I,{loading:d.value,data:R.value,"row-key":"id",isLeaf:"",pagination:!1,bordered:!1},{columns:l(()=>[e(x,{title:"\u83DC\u5355\u540D\u79F0","data-index":"menu_name",width:400},{cell:l(({record:o})=>[V("span",Ye,D(o.html),1),V("span",null,D(o.menu_name),1)]),_:1}),e(x,{title:"\u56FE\u6807","data-index":"icon",width:80},{cell:l(({record:o})=>[V("span",{class:Oe(["icon",o.icon])},null,2)]),_:1}),e(x,{title:"\u8DEF\u7531\u5730\u5740","data-index":"menu_path",width:160},{cell:l(({record:o})=>[V("span",He,D(o.menu_path),1)]),_:1}),e(x,{title:"Api\u63A5\u53E3","data-index":"api_rule",width:160},{cell:l(({record:o})=>[V("span",Je,D(o.api_rule),1)]),_:1}),e(x,{title:"\u6743\u9650\u6807\u8BC6","data-index":"menu_node",width:160},{cell:l(({record:o})=>[V("span",Ke,D(o.menu_node),1)]),_:1}),e(x,{title:"\u72B6\u6001",fixed:"right","data-index":"status",align:"center",width:80},{cell:l(({record:o})=>[e(U,{modelValue:o.status.value,"onUpdate:modelValue":F=>o.status.value=F,size:"small",type:"round",loading:o.loading,beforeChange:()=>o.switch=!0,onChange:F=>O(F,o),"checked-value":1,"unchecked-value":0},null,8,["modelValue","onUpdate:modelValue","loading","beforeChange","onChange"])]),_:1}),e(x,{title:"\u64CD\u4F5C",fixed:"right",align:"center",width:140},{cell:l(({record:o})=>[e(w,null,{default:l(()=>[B((g(),E(c,{hoverable:!1,onClick:F=>a(o.id),size:"small"},{default:l(()=>[b("\u7F16\u8F91")]),_:2},1032,["onClick"])),[[A,"system-menus-update"]]),B((g(),T("div",null,[e(q,{content:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onOk:F=>j(o.id)},{icon:l(()=>[e(z,{type:"red"})]),default:l(()=>[e(c,{size:"small"},{default:l(()=>[b("\u5220\u9664")]),_:1})]),_:2},1032,["onOk"])])),[[A,"system-menus-delete"]])]),_:2},1024)]),_:1})]),_:1},8,["loading","data"])])]),_:1},8,["tabs","modelValue","loading"])],64)}}});export{el as default};
