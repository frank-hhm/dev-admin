import{a4 as N,a6 as u,a8 as G,b8 as I,aD as b,al as V,ar as s,as as t,aK as R,am as $,aE as D,an as H,aX as j,au as S,ad as J,aF as Q,ai as W,ah as O,aU as P,aV as Y,av as L,bu as Z,bv as ee,aa as te,bn as ae,a_ as le,bo as se,bw as ne,ap as T,aq as U,bt as oe,bx as ue}from"./index.a552fe64.js";import{c as re,u as ie,g as q,s as ce,a as de,b as _e,d as me}from"./role.b2d607cd.js";const ve={name:"systemRoleCreate"},fe=N({...ve,emits:["success"],setup(K,{expose:k,emit:A}){const{proxy:d,proxy:{$utils:F}}=L(),B=A,y=u("create"),i=u(0),f=u(!1),c=u(),_=u({role_name:"",remarks:""}),E=G({role_name:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01"}]}),l=u(!1),o=()=>{!i.value||(l.value=!0,q({id:i.value}).then(e=>{_.value.role_name=e.data.role_name,_.value.remarks=e.data.remarks,l.value=!1}).catch(e=>{l.value=!1,F.errorMsg(e)}))},n=u(!1),m=()=>{var e;(e=d==null?void 0:d.$refs.createRef)==null||e.validate((a,h)=>{if(console.log(a),!a){if(n.value)return;n.value=!0;let p=null;y.value=="create"?p=re(_.value):p=ie(Object.assign({id:i.value},_.value)),p.then(v=>{F.successMsg(v.message),C(),B("success"),n.value=!1}).catch(v=>{F.errorMsg(v),n.value=!1})}})},w=(e=0)=>{e!=0?(y.value="update",i.value=e):y.value="create",S(()=>{o()}),f.value=!0},C=()=>{var e;return(e=d==null?void 0:d.$refs.createRef)==null||e.resetFields(),i.value=0,f.value=!1,!0};return k({open:w}),(e,a)=>{const h=J,p=Q,v=W,x=O,r=P,g=Y,X=I("loading"),z=I("btn");return b(),V("div",null,[s(g,{title:y.value=="create"?"\u6DFB\u52A0\u89D2\u8272":"\u7F16\u8F91\u89D2\u8272",onBeforeOk:m,onBeforeCancel:C,width:"400px",top:H(j)().ModalTop,class:"modal",visible:f.value,"onUpdate:visible":a[2]||(a[2]=M=>f.value=M),"align-center":!1,"title-align":"start","render-to-body":""},{footer:t(()=>[s(r,null,{default:t(()=>[R((b(),$(x,{onClick:C},{default:t(()=>[D("\u53D6\u6D88")]),_:1})),[[z]]),R((b(),$(x,{type:"primary",disabled:l.value||n.value,loading:n.value,onClick:m},{default:t(()=>[D("\u786E\u5B9A")]),_:1},8,["disabled","loading"])),[[z]])]),_:1})]),default:t(()=>[R((b(),$(v,{layout:"vertical",model:_.value,ref_key:"createRef",ref:c,rules:E},{default:t(()=>[s(p,{label:"\u89D2\u8272\u540D\u79F0\uFF1A",field:"role_name"},{default:t(()=>[s(h,{modelValue:_.value.role_name,"onUpdate:modelValue":a[0]||(a[0]=M=>_.value.role_name=M),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),s(p,{label:"\u5907\u6CE8\uFF1A",field:"remarks"},{default:t(()=>[s(h,{modelValue:_.value.remarks,"onUpdate:modelValue":a[1]||(a[1]=M=>_.value.remarks=M),placeholder:"\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[X,l.value]])]),_:1},8,["title","top","visible"])])}}});const pe={name:"systemRoleAuth"},ge=N({...pe,emits:["success"],setup(K,{expose:k,emit:A}){const{proxy:d,proxy:{$utils:F}}=L(),B=A,y=u(),i=u([]),f=u(!0),c=u([]),_=()=>{f.value=!0,de().then(e=>{i.value=e.data,S(()=>{var a;(a=d==null?void 0:d.$refs.treeRef)==null||a.expandAll()})}).catch(e=>{}),q({id:n.value}).then(e=>{c.value=E(e.data.rules),f.value=!1}).catch(e=>{F.errorMsg(e)})},E=e=>{let a=[];return e.forEach(h=>{a.push(Number(h))}),a},l=u(!1),o=()=>{l.value||(l.value=!0,ce({id:n.value,rules:c.value}).then(e=>{F.successMsg(e.message),B("success"),l.value=!1,C()}).catch(e=>{F.errorMsg(e),l.value=!1}))},n=u(0),m=u(!1),w=(e=0)=>{n.value=e,S(()=>{_()}),m.value=!0},C=()=>{n.value=0,c.value=[],m.value=!1};return k({open:w}),(e,a)=>{const h=Z,p=O,v=P,x=ee,r=I("loading");return b(),V("div",null,[s(x,{class:"drawer-default",title:"\u6388\u6743\u8BBE\u7F6E",visible:m.value,"onUpdate:visible":a[3]||(a[3]=g=>m.value=g),width:500},{default:t(()=>[R((b(),V("div",null,[s(h,{data:i.value,ref_key:"treeRef",ref:y,checkable:!0,"selected-keys":c.value,"onUpdate:selectedKeys":a[0]||(a[0]=g=>c.value=g),"checked-keys":c.value,"onUpdate:checkedKeys":a[1]||(a[1]=g=>c.value=g),"check-strictly":!0,fieldNames:{key:"id",title:"label",children:"children"},multiple:""},null,8,["data","selected-keys","checked-keys"])])),[[r,f.value]])]),footer:t(()=>[s(v,null,{default:t(()=>[s(p,{onClick:C},{default:t(()=>[D("\u53D6\u6D88")]),_:1}),s(p,{onClick:a[2]||(a[2]=g=>o()),type:"primary",loading:l.value,disabled:f.value||l.value},{default:t(()=>[D("\u786E\u5B9A")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["visible"])])}}}),be={class:"text-grey"},ke={class:"text-grey"},he=N({__name:"list",setup(K){const{proxy:k}=L(),{proxy:{$utils:A}}=L(),d=u(!0),F=u([]),B=u(),y=l=>{k==null||k.$refs.createComponentRef.open(l)},i=u({total:0,limit:j().PageLimit.value,page:1}),f=l=>{i.value=l,c()},c=(l=!1)=>{l&&(i.value.page=1),d.value=!0;let o={};o.page=i.value.page,o.limit=i.value.limit,_e(o).then(n=>{F.value=n.data.data,i.value.total=n.data.total,setTimeout(()=>{d.value=!1},300)}).catch(n=>{A.errorMsg(n)})},_=l=>{me({id:l}).then(o=>{c(),A.successMsg(o.message)}).catch(o=>{A.errorMsg(o)})},E=l=>{k==null||k.$refs.systemRoleAuthRef.open(l)};return te(()=>{c()}),(l,o)=>{const n=O,m=oe,w=ae,C=le,e=P,a=se,h=ue,p=ne,v=I("permission");return b(),$(p,null,{content:t(({height:x})=>[R((b(),$(n,{type:"primary",onClick:o[0]||(o[0]=r=>y(0))},{default:t(()=>[D(" \u6DFB\u52A0\u89D2\u8272 ")]),_:1})),[[v,"system-role-create"]]),s(fe,{ref_key:"createComponentRef",ref:B,onSuccess:o[1]||(o[1]=r=>c(!0))},null,512),s(ge,{ref:"systemRoleAuthRef",onSuccess:o[2]||(o[2]=r=>c(!0))},null,512),s(a,{loading:d.value,class:"mt12",data:F.value,"row-key":"id",isLeaf:"",pagination:!1,scroll:{x:"100%",y:x-39-32}},{columns:t(()=>[s(m,{title:"\u89D2\u8272\u540D\u79F0","data-index":"role_name"},{cell:t(({record:r})=>[T("span",null,U(r.role_name),1)]),_:1}),s(m,{title:"\u5907\u6CE8","data-index":"remarks"},{cell:t(({record:r})=>[T("span",be,U(r.remarks),1)]),_:1}),s(m,{title:"\u521B\u5EFA\u65F6\u95F4","data-index":"create_time",width:160},{cell:t(({record:r})=>[T("span",ke,U(r.create_time),1)]),_:1}),s(m,{title:"\u64CD\u4F5C",align:"right",fixed:"right",width:180},{cell:t(({record:r})=>[s(e,null,{default:t(()=>[R((b(),$(n,{onClick:g=>E(r.id),size:"small"},{default:t(()=>[D("\u6388\u6743\u8BBE\u7F6E")]),_:2},1032,["onClick"])),[[v,"system-role-auth"]]),R((b(),$(n,{onClick:g=>y(r.id),size:"small"},{default:t(()=>[D("\u7F16\u8F91")]),_:2},1032,["onClick"])),[[v,"system-role-update"]]),R((b(),V("div",null,[s(C,{content:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onOk:g=>_(r.id)},{icon:t(()=>[s(w,{type:"red"})]),default:t(()=>[s(n,{size:"small"},{default:t(()=>[D("\u5220\u9664")]),_:1})]),_:2},1032,["onOk"])])),[[v,"system-role-delete"]])]),_:2},1024)]),_:1})]),_:2},1032,["loading","data","scroll"])]),footer:t(()=>[s(h,{listPage:i.value,onChange:f},null,8,["listPage"])]),_:1})}}});export{he as default};
