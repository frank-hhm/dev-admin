import{d as K,s as q,u as H,r as u,a as X,bf as P,b,h as S,e as s,w as a,aP as A,c as B,f as C,j as w,k as O,aD as j,I as Y,F as Z,q as ee,B as G,v as J,M as te,l as N,bA as ae,a$ as le,o as se,bt as oe,b2 as ne,bv as ue,b6 as ie,b3 as re,bx as ce,g as U,t as z,b0 as de,b4 as me}from"./index.2bf9f14b.js";import{c as ve,u as _e,g as W,s as pe,a as fe,b as ge,d as be}from"./role.76d1ef80.js";const ke={name:"systemRoleCreate"},Fe=K({...ke,emits:["success"],setup(Q,{expose:x,emit:k}){const{isMobile:$}=q(H()),{proxy:c,proxy:{$utils:F}}=N(),E=k,y=u("create"),r=u(0),p=u(!1),i=u(),m=u({role_name:"",remarks:""}),M=X({role_name:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01"}]}),o=u(!1),l=()=>{!r.value||(o.value=!0,W({id:r.value}).then(e=>{m.value.role_name=e.data.role_name,m.value.remarks=e.data.remarks,o.value=!1}).catch(e=>{o.value=!1,F.errorMsg(e)}))},n=u(!1),v=()=>{var e;(e=c==null?void 0:c.$refs.createRef)==null||e.validate(t=>{if(t===void 0){if(n.value)return;n.value=!0;let _=null;y.value=="create"?_=ve(m.value):_=_e(Object.assign({id:r.value},m.value)),_&&_.then(f=>{F.successMsg(f.message),R(),E("success"),n.value=!1}).catch(f=>{F.errorMsg(f),n.value=!1})}})},I=(e=0)=>{e!=0?(y.value="update",r.value=e):y.value="create",j(()=>{l()}),p.value=!0},R=()=>{var e;return(e=c==null?void 0:c.$refs.createRef)==null||e.resetFields(),r.value=0,p.value=!1,!0};return x({open:I}),(e,t)=>{const _=Y,f=Z,L=ee,h=G,D=J,d=te,g=P("loading"),T=P("btn");return b(),S("div",null,[s(d,{title:y.value=="create"?"\u6DFB\u52A0\u89D2\u8272":"\u7F16\u8F91\u89D2\u8272",onBeforeOk:v,onBeforeCancel:R,width:w($)?"calc(100% - 20px)":"400px",top:w(O)().ModalTop,class:"modal",visible:p.value,"onUpdate:visible":t[2]||(t[2]=V=>p.value=V),"align-center":!1,"title-align":"start","render-to-body":""},{footer:a(()=>[s(D,null,{default:a(()=>[A((b(),B(h,{onClick:R},{default:a(()=>t[3]||(t[3]=[C("\u53D6\u6D88")])),_:1})),[[T]]),A((b(),B(h,{type:"primary",disabled:o.value||n.value,loading:n.value,onClick:v},{default:a(()=>t[4]||(t[4]=[C("\u786E\u5B9A")])),_:1},8,["disabled","loading"])),[[T]])]),_:1})]),default:a(()=>[A((b(),B(L,{layout:"vertical",model:m.value,ref_key:"createRef",ref:i,rules:M},{default:a(()=>[s(f,{label:"\u89D2\u8272\u540D\u79F0\uFF1A",field:"role_name"},{default:a(()=>[s(_,{modelValue:m.value.role_name,"onUpdate:modelValue":t[0]||(t[0]=V=>m.value.role_name=V),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),s(f,{label:"\u5907\u6CE8\uFF1A",field:"remarks"},{default:a(()=>[s(_,{modelValue:m.value.remarks,"onUpdate:modelValue":t[1]||(t[1]=V=>m.value.remarks=V),placeholder:"\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[g,o.value]])]),_:1},8,["title","width","top","visible"])])}}});const ye={name:"systemRoleAuth"},Re=K({...ye,emits:["success"],setup(Q,{expose:x,emit:k}){const{isMobile:$}=q(H()),{proxy:c,proxy:{$utils:F}}=N(),E=k,y=u(),r=u([]),p=u(!0),i=u([]),m=()=>{p.value=!0,fe().then(e=>{r.value=e.data,j(()=>{var t;(t=c==null?void 0:c.$refs.treeRef)==null||t.expandAll()})}).catch(e=>{}),W({id:n.value}).then(e=>{i.value=M(e.data.rules),p.value=!1}).catch(e=>{F.errorMsg(e)})},M=e=>{let t=[];return e.forEach(_=>{t.push(Number(_))}),t},o=u(!1),l=()=>{o.value||(o.value=!0,pe({id:n.value,rules:i.value}).then(e=>{F.successMsg(e.message),E("success"),o.value=!1,R()}).catch(e=>{F.errorMsg(e),o.value=!1}))},n=u(0),v=u(!1),I=(e=0)=>{n.value=e,j(()=>{m()}),v.value=!0},R=()=>{n.value=0,i.value=[],v.value=!1};return x({open:I}),(e,t)=>{const _=ae,f=G,L=J,h=le,D=P("loading");return b(),S("div",null,[s(h,{class:"drawer-default",title:"\u6388\u6743\u8BBE\u7F6E",visible:v.value,"onUpdate:visible":t[3]||(t[3]=d=>v.value=d),width:w($)?"calc(100% - 20px)":"500px"},{default:a(()=>[A((b(),S("div",null,[s(_,{data:r.value,ref_key:"treeRef",ref:y,checkable:!0,"selected-keys":i.value,"onUpdate:selectedKeys":t[0]||(t[0]=d=>i.value=d),"checked-keys":i.value,"onUpdate:checkedKeys":t[1]||(t[1]=d=>i.value=d),"check-strictly":!0,fieldNames:{key:"id",title:"label",children:"children"},multiple:""},null,8,["data","selected-keys","checked-keys"])])),[[D,p.value]])]),footer:a(()=>[s(L,null,{default:a(()=>[s(f,{onClick:R},{default:a(()=>t[4]||(t[4]=[C("\u53D6\u6D88")])),_:1}),s(f,{onClick:t[2]||(t[2]=d=>l()),type:"primary",loading:o.value,disabled:p.value||o.value},{default:a(()=>t[5]||(t[5]=[C("\u786E\u5B9A")])),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["visible","width"])])}}}),Ce={class:"text-grey"},De={class:"text-grey"},$e=K({__name:"list",setup(Q){const{isMobile:x}=q(H()),{proxy:k}=N(),{proxy:{$utils:$}}=N(),c=u(!0),F=u([]),E=u(),y=o=>{k==null||k.$refs.createComponentRef.open(o)},r=u({total:0,limit:O().PageLimit.value,page:1}),p=o=>{r.value=o,i()},i=(o=!1)=>{o&&(r.value.page=1),c.value=!0;let l={page:r.value.page,limit:Number(r.value.limit||O().PageLimit.value)};ge(l).then(n=>{F.value=n.data.data,r.value.total=n.data.total,setTimeout(()=>{c.value=!1},300)}).catch(n=>{$.errorMsg(n)})},m=o=>{be({id:o}).then(l=>{i(),$.successMsg(l.message)}).catch(l=>{$.errorMsg(l)})},M=o=>{k==null||k.$refs.systemRoleAuthRef.open(o)};return se(()=>{i()}),(o,l)=>{const n=oe,v=G,I=ne,R=J,e=de,t=ue,_=ie,f=re,L=me,h=ce,D=P("permission");return b(),B(h,{pageHeader:""},{"page-header-left":a(()=>l[4]||(l[4]=[C(" \u89D2\u8272\u5217\u8868 ")])),"page-header-right":a(()=>[s(R,null,{default:a(()=>[s(I,{content:"\u5237\u65B0"},{default:a(()=>[s(v,{onClick:l[0]||(l[0]=d=>i(!0)),size:"small"},{default:a(()=>[s(n)]),_:1})]),_:1}),A((b(),B(v,{type:"primary",size:"small",onClick:l[1]||(l[1]=d=>y(0))},{default:a(()=>l[5]||(l[5]=[C(" \u6DFB\u52A0\u89D2\u8272 ")])),_:1})),[[D,"system-role-create"]])]),_:1}),s(Fe,{ref_key:"createComponentRef",ref:E,onSuccess:l[2]||(l[2]=d=>i(!0))},null,512),s(Re,{ref:"systemRoleAuthRef",onSuccess:l[3]||(l[3]=d=>i(!0))},null,512)]),content:a(({height:d})=>[s(f,{loading:c.value,data:F.value,"row-key":"id",isLeaf:"",pagination:!1,scroll:{x:"100%",y:d-39}},{columns:a(()=>[s(e,{title:"\u89D2\u8272\u540D\u79F0","data-index":"role_name",width:w(x)?160:void 0},{cell:a(({record:g})=>[U("span",null,z(g.role_name),1)]),_:1},8,["width"]),s(e,{title:"\u5907\u6CE8","data-index":"remarks",width:w(x)?160:void 0},{cell:a(({record:g})=>[U("span",Ce,z(g.remarks||"--"),1)]),_:1},8,["width"]),s(e,{title:"\u521B\u5EFA\u65F6\u95F4","data-index":"create_time",width:160},{cell:a(({record:g})=>[U("span",De,z(g.create_time),1)]),_:1}),s(e,{title:"\u64CD\u4F5C",align:"right",fixed:w(x)?void 0:"right",width:180},{cell:a(({record:g})=>[s(R,null,{default:a(()=>[A((b(),B(v,{onClick:T=>M(g.id),size:"small"},{default:a(()=>l[6]||(l[6]=[C("\u6388\u6743\u8BBE\u7F6E")])),_:2},1032,["onClick"])),[[D,"system-role-auth"]]),A((b(),B(v,{onClick:T=>y(g.id),size:"small"},{default:a(()=>l[7]||(l[7]=[C("\u7F16\u8F91")])),_:2},1032,["onClick"])),[[D,"system-role-update"]]),A((b(),S("div",null,[s(_,{content:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onOk:T=>m(g.id)},{icon:a(()=>[s(t,{type:"red"})]),default:a(()=>[s(v,{size:"small"},{default:a(()=>l[8]||(l[8]=[C("\u5220\u9664")])),_:1})]),_:2},1032,["onOk"])])),[[D,"system-role-delete"]])]),_:2},1024)]),_:1},8,["fixed"])]),_:2},1032,["loading","data","scroll"])]),footer:a(()=>[s(L,{listPage:r.value,onChange:p},null,8,["listPage"])]),_:1})}}});export{$e as default};
