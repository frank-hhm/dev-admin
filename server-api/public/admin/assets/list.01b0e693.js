import{d as Q,s as X,u as Y,r as p,bh as ee,a as xe,bi as Ce,aE as K,bf as N,b as v,h as j,e as l,w as e,aP as B,c as y,f as g,j as k,i as Fe,aZ as le,bj as ae,t as E,k as Ve,l as ue,bk as ye,bl as Ee,aD as te,I as ke,F as Be,bm as De,bn as ne,bo as oe,ay as Me,B as se,bp as Ae,bq as Re,q as he,v as de,M as we,br as Ie,bs as Ue,aH as Se,o as $e,bt as Te,b2 as Le,bu as ze,bv as Ne,b6 as je,b3 as Oe,bw as qe,bx as He,g as R,aS as Pe,by as We,bz as Ge,b0 as Ze}from"./index.2bf9f14b.js";const Je={name:"menusCreateComponent"},Ke=Q({...Je,emits:["success"],setup(ie,{expose:U,emit:O}){const{isMobile:D}=X(Y()),{proxy:_,proxy:{$utils:M}}=ue(),m=p("60px"),S=p(ee().getEnumItem("StatusEnum")),b=p("create"),C=p(0),x=p(!1),q=p(),u=p({module:1,type:1,menu_name:"",pid:null,menu_path:"",menu_node:"",params:"",icon:"",sort:0,status:1,api_rule:""}),H=()=>{A(),C.value&&(i.value=!0,Ie({id:C.value}).then(n=>{u.value.type=Number(n.data.type),u.value.module=Number(n.data.module),u.value.menu_name=n.data.menu_name,n.data.pid>0&&(u.value.pid=Number(n.data.pid)),u.value.menu_path=n.data.menu_path,u.value.menu_node=n.data.menu_node,u.value.params=n.data.params,u.value.icon=n.data.icon,u.value.sort=n.data.sort,u.value.status=n.data.status.value,u.value.api_rule=n.data.api_rule,i.value=!1}).catch(n=>{M.errorMsg(n)}))},P=xe({menu_name:[{required:!0,message:"\u83DC\u5355\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01"}]}),i=p(!1),t=O,c=p(!1),$=()=>{var n;(n=_==null?void 0:_.$refs.createRef)==null||n.validate(a=>{if(a===void 0){if(c.value)return;c.value=!0;let f=null;b.value=="create"?f=ye(u.value):f=Ee(Object.assign({id:C.value},u.value)),f&&f.then(r=>{M.successMsg(r.message),h(),t("success"),c.value=!1}).catch(r=>{M.errorMsg(r),c.value=!1})}})},T=p([]),A=()=>{let n={};C.value&&(n.pid=C.value),Ue(n).then(a=>{T.value=a.data.menuList}).catch(a=>{M.errorMsg(a)})},W=p(),L=p(),F=n=>{u.value.api_rule=n.rule},G=n=>{u.value.icon=n},Z=(n=0,a)=>{n!=0?(b.value="update",C.value=n):b.value="create",a!="all"&&(u.value.module=a),te(()=>{H()}),x.value=!0},h=()=>{var n;return(n=_==null?void 0:_.$refs.createRef)==null||n.resetFields(),C.value=0,x.value=!1,!0};return U({open:Z}),(n,a)=>{const f=ke,r=Be,d=De,s=ne,V=oe,me=Ce,re=Me,z=se,pe=K("select-icon-modal"),w=Ae,ce=Re,fe=he,_e=de,ve=K("select-rule-modal"),be=we,ge=N("loading"),J=N("btn");return v(),j("div",null,[l(be,{title:b.value=="create"?"\u6DFB\u52A0\u83DC\u5355":"\u7F16\u8F91\u83DC\u5355",onBeforeOk:$,onBeforeCancel:h,width:k(D)?"calc(100% - 20px)":"900px",top:k(Ve)().ModalTop,class:"modal",visible:x.value,"onUpdate:visible":a[13]||(a[13]=o=>x.value=o),"align-center":!1,"title-align":"start","render-to-body":""},{footer:e(()=>[l(_e,null,{default:e(()=>[B((v(),y(z,{onClick:h},{default:e(()=>a[19]||(a[19]=[g("\u53D6\u6D88")])),_:1})),[[J]]),B((v(),y(z,{type:"primary",disabled:i.value||c.value,loading:i.value,onClick:$},{default:e(()=>a[20]||(a[20]=[g("\u786E\u5B9A")])),_:1},8,["disabled","loading"])),[[J]])]),_:1})]),default:e(()=>[B((v(),y(fe,{model:u.value,layout:k(D)?"vertical":"horizontal",ref_key:"createRef",ref:q,rules:P},{default:e(()=>[l(w,{gutter:20},{default:e(()=>[l(d,{md:24,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u83DC\u5355\u540D\u79F0",field:"menu_name"},{default:e(()=>[l(f,{modelValue:u.value.menu_name,"onUpdate:modelValue":a[0]||(a[0]=o=>u.value.menu_name=o),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),l(d,{md:24,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u6A21\u5757",field:"module"},{default:e(()=>[l(V,{modelValue:u.value.module,"onUpdate:modelValue":a[1]||(a[1]=o=>u.value.module=o)},{default:e(()=>[l(s,{value:1},{default:e(()=>a[14]||(a[14]=[g("\u7CFB\u7EDF")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),l(d,{md:24,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u7C7B\u578B",field:"type"},{default:e(()=>[l(V,{modelValue:u.value.type,"onUpdate:modelValue":a[2]||(a[2]=o=>u.value.type=o)},{default:e(()=>[l(s,{value:1},{default:e(()=>a[15]||(a[15]=[g("\u83DC\u5355")])),_:1}),l(s,{value:2},{default:e(()=>a[16]||(a[16]=[g("\u4E8B\u4EF6")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),l(d,{md:12,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u7236\u7EA7\u5206\u7C7B",field:"pid"},{default:e(()=>[l(me,{modelValue:u.value.pid,"onUpdate:modelValue":a[3]||(a[3]=o=>u.value.pid=o),options:T.value,"allow-search":"","allow-clear":"",class:"form-select-fil","check-strictly":"",placeholder:"\u8BF7\u9009\u62E9\u7236\u7EA7\u5206\u7C7B"},null,8,["modelValue","options"])]),_:1},8,["label-col-flex"])]),_:1}),l(d,{md:12,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u56FE\u6807",field:"icon",class:"default-append"},{default:e(()=>[l(f,{modelValue:u.value.icon,"onUpdate:modelValue":a[5]||(a[5]=o=>u.value.icon=o),placeholder:"\u9009\u62E9\u56FE\u6807"},{prefix:e(()=>[l(re)]),append:e(()=>[l(z,{onClick:a[4]||(a[4]=()=>{var o,I;(I=(o=k(_))==null?void 0:o.$refs.selectModalIconRef)==null||I.open()})},{default:e(()=>a[17]||(a[17]=[g(" \u56FE\u6807 ")])),_:1}),l(pe,{ref_key:"selectModalIconRef",ref:L,onChange:G},null,512)]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),l(w,{gutter:20},{default:e(()=>[u.value.type!=3?(v(),y(d,{key:0,md:12,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u8DEF\u7531\u5730\u5740",field:"menu_path"},{default:e(()=>[l(f,{modelValue:u.value.menu_path,"onUpdate:modelValue":a[6]||(a[6]=o=>u.value.menu_path=o),placeholder:"\u8BF7\u8F93\u5165\u8DEF\u7531\u5730\u5740"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})):Fe("",!0),l(d,{md:12,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u63A5\u53E3",field:"api_rule",class:"default-append"},{default:e(()=>[l(f,{disabled:"",modelValue:u.value.api_rule,"onUpdate:modelValue":a[8]||(a[8]=o=>u.value.api_rule=o),placeholder:"\u8BF7\u9009\u62E9\u63A5\u53E3"},{append:e(()=>[l(z,{onClick:a[7]||(a[7]=()=>{var o,I;(I=(o=k(_))==null?void 0:o.$refs.selectRuleRef)==null||I.open()})},{default:e(()=>a[18]||(a[18]=[g(" \u63A5\u53E3 ")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1}),l(d,{md:12,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u6743\u9650\u6807\u8BC6",field:"menu_node"},{default:e(()=>[l(f,{modelValue:u.value.menu_node,"onUpdate:modelValue":a[9]||(a[9]=o=>u.value.menu_node=o),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u6807\u8BC6"},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),l(w,{gutter:20},{default:e(()=>[l(d,{md:24,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u53C2\u6570",field:"params"},{default:e(()=>[l(f,{modelValue:u.value.params,"onUpdate:modelValue":a[10]||(a[10]=o=>u.value.params=o)},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),l(w,{gutter:20},{default:e(()=>[l(d,{md:12,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u6392\u5E8F\uFF1A",field:"sort"},{default:e(()=>[l(ce,{modelValue:u.value.sort,"onUpdate:modelValue":a[11]||(a[11]=o=>u.value.sort=o),min:0,max:1e4},null,8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1}),l(w,{gutter:20},{default:e(()=>[l(d,{md:12,xs:24},{default:e(()=>[l(r,{"label-col-flex":m.value,label:"\u72B6\u6001",field:"status"},{default:e(()=>[l(V,{modelValue:u.value.status,"onUpdate:modelValue":a[12]||(a[12]=o=>u.value.status=o)},{default:e(()=>[(v(!0),j(le,null,ae(S.value,o=>(v(),y(s,{value:o.value,key:o.value},{default:e(()=>[g(E(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-col-flex"])]),_:1})]),_:1})]),_:1},8,["model","layout","rules"])),[[ge,i.value]]),l(ve,{ref_key:"selectRuleRef",ref:W,onChange:F},null,512)]),_:1},8,["title","width","top","visible"])])}}}),Qe={class:"text-grey"},Xe={class:"text-grey"},Ye={class:"text-grey"},el={class:"text-grey"},al=Q({__name:"list",setup(ie){const{isMobile:U}=X(Y()),O=Se(),{proxy:D,proxy:{$utils:_}}=ue(),M=p(),m=p(!0),S=p([]),b=(i=!1)=>{m.value=!0;let t={};x.value!=""&&(t.module=x.value),qe(t).then(c=>{S.value=c.data.list,i||O.setMenus(c.data.menusList),setTimeout(()=>{m.value=!1},300)}).catch(c=>{_.errorMsg(c),m.value=!1})},C=p([{name:"\u5168\u90E8",value:"all"},{name:"\u7CFB\u7EDF",value:"1"}]);$e(()=>{te(()=>{let i=ee().getEnumItem("AppsTypeEnum");for(let t in i)C.value.push(i[t])}),b(!1)});const x=p("all"),q=i=>{x.value=String(i),b()},u=i=>{var t;(t=D==null?void 0:D.$refs.createComponentRef)==null||t.open(i,x.value)},H=(i,t)=>{t.switch===!0&&(t.loading=!0,m.value=!0,We({id:t.id,status:i}).then(c=>{t.loading=!1,b(),_.successMsg(c)}).catch(c=>{t.loading=!1,b(),_.errorMsg(c)}))},P=i=>{Ge({id:i}).then(t=>{b(),_.successMsg(t.message)}).catch(t=>{_.errorMsg(t)})};return(i,t)=>{const c=ne,$=oe,T=Te,A=se,W=Le,L=de,F=Ze,G=ze,Z=Ne,h=je,n=Oe,a=He,f=N("permission"),r=N("permission-disabled");return v(),y(a,{pageHeader:"",hideFooter:""},{"page-header-left":e(()=>[l($,{type:"button",modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=d=>x.value=d),onChange:q},{default:e(()=>[(v(!0),j(le,null,ae(C.value,(d,s)=>(v(),y(c,{key:s,disabled:m.value,value:d.value},{default:e(()=>[g(E(d.name),1)]),_:2},1032,["disabled","value"]))),128))]),_:1},8,["modelValue"])]),"page-header-right":e(()=>[l(L,null,{default:e(()=>[l(W,{content:"\u5237\u65B0"},{default:e(()=>[l(A,{onClick:t[1]||(t[1]=d=>b()),size:"small"},{default:e(()=>[l(T)]),_:1})]),_:1}),B((v(),y(A,{type:"primary",size:"small",onClick:t[2]||(t[2]=d=>u(0))},{default:e(()=>t[4]||(t[4]=[g(" \u6DFB\u52A0\u83DC\u5355 ")])),_:1})),[[f,"system-menus-create"]])]),_:1}),l(Ke,{ref_key:"createComponentRef",ref:M,onSuccess:t[3]||(t[3]=d=>b())},null,512)]),content:e(({height:d})=>[l(n,{loading:m.value,data:S.value,"row-key":"id",isLeaf:"",pagination:!1,bordered:!1,scroll:{x:"100%",y:d-39}},{columns:e(()=>[l(F,{title:"\u83DC\u5355\u540D\u79F0","data-index":"menu_name",minWidth:240},{cell:e(({record:s})=>[R("span",Qe,E(s.html),1),R("span",null,E(s.menu_name),1)]),_:1}),l(F,{title:"\u56FE\u6807","data-index":"icon",width:80},{cell:e(({record:s})=>[R("span",{class:Pe(["icon",s.icon])},null,2)]),_:1}),l(F,{title:"\u8DEF\u7531\u5730\u5740","data-index":"menu_path",width:160},{cell:e(({record:s})=>[R("span",Xe,E(s.menu_path),1)]),_:1}),l(F,{title:"Api\u63A5\u53E3","data-index":"api_rule",minWidth:200},{cell:e(({record:s})=>[R("span",Ye,E(s.api_rule),1)]),_:1}),l(F,{title:"\u6743\u9650\u6807\u8BC6","data-index":"menu_node",width:160},{cell:e(({record:s})=>[R("span",el,E(s.menu_node),1)]),_:1}),l(F,{title:"\u72B6\u6001",fixed:k(U)?void 0:"right","data-index":"status",align:"center",width:80},{cell:e(({record:s})=>[B(l(G,{modelValue:s.status.value,"onUpdate:modelValue":V=>s.status.value=V,size:"small",type:"round",loading:s.loading,beforeChange:()=>s.switch=!0,onChange:V=>H(V,s),"checked-value":1,"unchecked-value":0},null,8,["modelValue","onUpdate:modelValue","loading","beforeChange","onChange"]),[[r,"system-menus-status"]])]),_:1},8,["fixed"]),l(F,{title:"\u64CD\u4F5C",fixed:k(U)?void 0:"right",align:"center",width:140},{cell:e(({record:s})=>[l(L,null,{default:e(()=>[B((v(),y(A,{hoverable:!1,onClick:V=>u(s.id),size:"small"},{default:e(()=>t[5]||(t[5]=[g("\u7F16\u8F91")])),_:2},1032,["onClick"])),[[f,"system-menus-update"]]),B((v(),j("div",null,[l(h,{content:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onOk:V=>P(s.id)},{icon:e(()=>[l(Z,{type:"red"})]),default:e(()=>[l(A,{size:"small"},{default:e(()=>t[6]||(t[6]=[g("\u5220\u9664")])),_:1})]),_:2},1032,["onOk"])])),[[f,"system-menus-delete"]])]),_:2},1024)]),_:1},8,["fixed"])]),_:2},1032,["loading","data","scroll"])]),_:1})}}});export{al as default};
